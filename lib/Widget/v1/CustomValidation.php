<?php
/**
 * CustomValidation
 * PHP version 7.4
 *
 * @category Class
 * @package  Dana\Widget\v1
 * @author   DANA Indonesia
 * @link     https://dashboard.dana.id/
 */

/**
 * Widget API
 *
 * API for doing operations in DANA Widget
 *
 * The version of the OpenAPI document: 1.0.0
 * Generated by: https://openapi-generator.tech
 * Generator version: 7.12.0
 */

namespace Dana\Widget\v1;

use Dana\ApiException;
use Dana\Utils\DateValidation;
use Dana\Widget\v1\Model\WidgetPaymentRequest;

/**
 * CustomValidation Class
 *
 * This class provides custom validation functions for Widget API requests.
 * Validations are registered in the validationRegistry and executed via CustomValidation().
 */
class CustomValidation
{
    /**
     * Validation registry maps request class names to their validation functions
     *
     * @var callable[]
     */
    private static $validationRegistry = [
        'Dana\Widget\v1\Model\WidgetPaymentRequest' => [
            'validateValidUpToWidgetPaymentRequest',
        ],
        // Add more request types and their validations here as needed
    ];

    /**
     * Perform custom validations on the request based on its type
     *
     * This function uses instanceof checks to determine the request type and runs
     * the appropriate validations from the registry.
     *
     * @param mixed $request The request object to validate (can be any type)
     * @return void
     * @throws ApiException if validation fails
     */
    public static function validate($request)
    {
        if ($request === null) {
            return;
        }

        // Get the class name of the request
        $className = get_class($request);

        // Check if this request type has validations registered
        if (isset(self::$validationRegistry[$className])) {
            foreach (self::$validationRegistry[$className] as $validatorName) {
                if (method_exists(self::class, $validatorName)) {
                    self::$validatorName($request);
                }
            }
        }
    }

    /**
     * Validate validUpTo field in WidgetPaymentRequest
     *
     * @param WidgetPaymentRequest $request The request to validate
     * @return void
     * @throws ApiException if validation fails
     */
    private static function validateValidUpToWidgetPaymentRequest($request)
    {
        if ($request === null) {
            return;
        }

        if ($request->getValidUpTo() !== null) {
            try {
                DateValidation::validateValidUpToDate($request->getValidUpTo());
            } catch (\Exception $e) {
                throw new ApiException(
                    'validUpTo validation failed: ' . $e->getMessage(),
                    0,
                    null,
                    null
                );
            }
        }
    }
}
